[MAIN]
output_dir_loc  = "/Users/nathalyn/Desktop/Masters/ACTS-data"
output_dir_name = "Feb1-simAlignment-test"
log_level = "DEBUG" #DEBUG/INFO etc

[PREPROCESSING]
enable = false
input_dirs = ["/Users/nathalyn/Desktop/Masters/Apollon_cosmic_runs/data_Run167_Nov18_19/ev_data",
      "/Users/nathalyn/Desktop/Masters/Apollon_cosmic_runs/data_Run169_Nov19_21/ev_data",
      "/Users/nathalyn/Desktop/Masters/Apollon_cosmic_runs/data_Run172_Nov21_24/ev_data",
      "/Users/nathalyn/Desktop/Masters/Apollon_cosmic_runs/data_Run173_Nov24_25/ev_data",
      "/Users/nathalyn/Desktop/Masters/Apollon_cosmic_runs/data_Run175_Nov25_26/ev_data"]  # Only used if preprocessing is enabled
input_tree = "MyTree"
input_branch = "event"

[DETECTOR]
fill_surface_map = true #true/false
store_mode = "gaussian"      # "fixed" (hard-coded pattern) or "gaussian"
# Only used if mode = "gaussian"
long_binning  = "binY"   # maps to Acts::BinningValue via GeometryOptions or string
short_binning = "binZ"
long_trans_std  = 0.0    # in um
short_trans_std = 0.0

[ALIGNMENT_PROVIDER]
enable              = false
tree_name           = "alignment-parameters"
parameters_filepath = "/Users/nathalyn/Desktop/Masters/ACTS-data/Jan26-alignmentrun-test/alignment-parameters.root" #"/Users/nathalyn/Desktop/Masters/ACTS-data/second-run-Dec28-with-alignment/Alignment/alignment-parameters.root"

[DATA_READER]
#ApollonRootDataReader | DummyReader | RootSimClusterReader | RootSimTrackReader | RootTrackReader
type = "RootSimTrackReader"

[MEAS_EMBEDDING]
enable = false
types = ["SignalMeasurementEmbedding", "BkgMeasurementEmbedding"]

[SEEDING]
enable = false
types = ["ApollonSeedingAlgorithm"] #ApollonSeedingAlgorithm | SimpleSeedingAlgorithm

[TRACK_FITTING]
enable = true
types = ["AlignmentAlgorithm", "KFTrackFittingAlgorithm"]

[TRACK_CLEANING]
enable = false
types  = ["TrackCleaningAlgorithm"]

[DATA_WRITER]
# RootMeasurementWriter | RootSeedWriter | RootTrackWriter | RootSimClusterWriter | RootSimSeedWriter | RootSimTrackWriter | AlignmentParametersWriter | RootCleaningTrackWriter
types = ["RootSimSeedWriter", "RootSimTrackWriter", "AlignmentParametersWriter"]


#--------------- Low-level configurations --------------- (Roman- your fault that it is messy)

# ----- Readers -----
[ApollonRootDataReader]
outputSourceLinks = "Measurements"
filePaths         = ["dummy.root"] #["/Users/nathalyn/Desktop/Masters/ACTS-data/third-run-Dec28-no-alignment/Preprocessing/preprocessed.root"]
treeName          = "MyTree"
eventKey          = "event"
minGeoId          = 10
maxGeoId          = 18

[RootTrackReader]
treeName          = "fitted-tracks"
outputMeasurements = "SimMeasurements"
outputSeeds        = "Seeds"
outputTracks      = "CleaningTracks"
minChi2            = 250
maxChi2            = 650
mergeIntoOneEvent  = true
filePaths          = ["/Users/nathalyn/Desktop/Masters/ACTS-data/third-run-Dec28-no-alignment/FullTracking/fitted-tracks.root"]

[DummyReader]
outputSourceLinks = "SimMeasurements"
outputSimClusters = "SimClusters"
nEvents = 100

[RootSimClusterReader]
outputSourceLinks   = "Measurements"
outputSimClusters   = "SimClusters"
filePaths           = ["/Users/nathalyn/Desktop/Masters/ACTS-data/oldTesting/clusters-sim-sig-misaligned-0.root"]
treeName            = "clusters"
minGeoId            = 10
maxGeoId            = 28
surfaceLocalToGlobal = true

[RootSimTrackReader]
type               = "RootSimTrackReader"
filePaths          = ["/Users/nathalyn/Desktop/Masters/ACTS-data/Feb1-fullSim-test6/sim-fitted-tracks.root"]
treeName           = "fitted-tracks"
outputMeasurements = "SimMeasurements"
outputSimClusters  = "SimClusters"
outputSeeds        = "Seeds"
minChi2            = 0.0
maxChi2            = 20.0
mergeIntoOneEvent  = true

# ----- Measurement Embedding -----
[SignalMeasurementEmbedding]
type = "SignalMeasurementEmbedding"
meas_creator_maxSteps = 1000
inputSourceLinks = "SimMeasurements"
inputSimClusters = "SimClusters"
outputSourceLinks = "Measurements1"
outputSimClusters = "Clusters1"
nMeasurements = 500

[BkgMeasurementEmbedding]
type = "BkgMeasurementEmbedding"
bkgCreator_resolution = [5.0e-6, 5.0e-6]
bkgCreator_nMeasurements = 20
inputSourceLinks = "Measurements1"
inputSimClusters = "Clusters1"
outputSourceLinks = "Measurements"
outputSimClusters = "Clusters"
nMeasurements = 1

# ----- Seeding -----
[ApollonSeedingAlgorithm]
type = "ApollonSeedingAlgorithm"
inputSourceLinks      = "Measurements"
outputSeeds           = "Seeds"

nCellsThetaX          = 500
nCellsRhoX            = 4000
nCellsThetaY          = 500
nCellsRhoY            = 4000
nLSIterations         = 2

minLayers             = 4 #5
maxLayers             = 4 #5
minSeedSize           = 4 #5
maxSeedSize           = 100
minScanEnergyGeV      = 1.0
maxScanEnergyGeV      = 1.0
energyScanStepGeV     = 0.001
maxConnectionDistance = 2.0
scope                 = "detector2"   # or detector2/fullDetector

minXCountDet1         = 4 #3
minXCountDet2         = 3 #2
minSeedSizeDet1       = 5
maxSeedSizeDet1       = 100
minSeedSizeDet2       = 4
maxSeedSizeDet2       = 100
maxLineChi2Det1       = 0.01 #0.1
maxLineChi2Det2       = 0.01 #0.1

# ----- Track Fitting -----
[AlignmentAlgorithm]
type = "AlignmentAlgorithm"
inputTrackCandidates      = "Seeds"
outputAlignmentParameters = "AlignmentParameters"
maxSteps                  = 1000        # alignment KFOptions.maxSteps
chi2ONdfCutOff            = 0.001       # 1e-3
deltaChi2ONdfCutOffN      = 10
deltaChi2ONdfCutOffValue  = 1e-5
maxNumIterations          = 10 #200
alignmentMask             = "Center1Center2Rotation2"  # Center1 | Center2 | Rotation2
alignmentMode             = "global"  # "local" or "global"

[KFTrackFittingAlgorithm]
type = "KFTrackFittingAlgorithm"
inputTrackCandidates = "Seeds"   # must match seeding output handle
outputTracks         = "Tracks"  # must match writer inputTracks
maxSteps             = 100000

# ----- Track Cleaning -----
[TrackCleaningAlgorithm]
type = "TrackCleaningAlgorithm"
inputCleaningTracks = "CleaningTracks"          # use Acts tracks, not pre-flattened
inputActsTracks     = ""    # from KFTrackFittingAlgorithm
outputTracks        = "CleaningTracks-filtered"

# ----- Writers -----
[RootMeasurementWriter]
type = "RootMeasurementWriter"
inputMeasurements = "Measurements"    # must match reader's outputSourceLinks
treeName          = "measurements"
filePath          = "measurements.root"

[RootSeedWriter]
type = "RootSeedWriter"
inputSeeds         = "Seeds"          
inputTruthClusters = "TruthClusters"  # can be left unused for now
treeName           = "seeds"
filePath           = "seeds.root"

[RootTrackWriter]
type = "RootTrackWriter"
inputTracks = "Tracks"              
treeName    = "tracks-raw"
filePath    = "tracks-raw.root"

[AlignmentParametersWriter]
type = "AlignmentParametersWriter"
inputAlignmentResults = "AlignmentParameters"
treeName              = "alignment-parameters"
filePath              = "sim-alignment-parameters.root"

[RootCleaningTrackWriter]
type = "RootCleaningTrackWriter"
inputTracks = "CleaningTracks-filtered"
treeName    = "tracks-filtered"
filePath    = "tracks-filtered.root"

[SigClusterWriter]
type = "RootSimClusterWriter"
inputClusters = "Clusters1"
treeName = "clusters"
filePath      = "sim-sig-clusters.root"

[BkgClusterWriter]
type = "RootSimClusterWriter"
inputClusters = "Clusters"
treeName = "clusters"
filePath      = "sim-bkg-clusters.root"

[RootSimSeedWriter]
type = "RootSimSeedWriter"
inputSeeds         = "Seeds"          
inputTruthClusters = "SimClusters"  
treeName           = "seeds"
filePath           = "sim-alignment-Seeds.root"

[RootSimTrackWriter]
type = "RootSimTrackWriter"
inputTracks = "Tracks"
inputSimClusters = "SimClusters"              
treeName    = "fitted-tracks"
filePath    = "sim-alignment-fitted-tracks.root"